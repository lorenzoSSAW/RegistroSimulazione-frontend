import React, { useState, useEffect } from 'react';import ClassList from './ClassList';import RegisterTable from './RegisterTable';import ActionsBar from './ActionsBar';import StudentView from './StudentView';export default function Dashboard({ user, backend, socket, onLogout }){const [selectedClass, setSelectedClass] = useState(user.role==='student'? user.classId : '1A');const [snapshot, setSnapshot] = useState(null);useEffect(()=>{ fetchClass(selectedClass); }, [selectedClass]);useEffect(()=>{ if(!socket) return; socket.on('presence_updated', (p)=>{ if(p.classId===selectedClass) fetchClass(selectedClass); }); socket.on('grade_updated', (g)=>{ if(g.classId===selectedClass) fetchClass(selectedClass); }); return ()=>{ if(socket){ socket.off('presence_updated'); socket.off('grade_updated'); } }; }, [socket, selectedClass]);const fetchClass = async (cid)=>{ try{ const r = await fetch(backend+'/api/classes/'+cid); const j = await r.json(); setSnapshot(j); }catch(e){ console.error(e); } }; if(user.role==='student') return <StudentView user={user} classes={snapshot} onLogout={onLogout} />;return (<div className='app'><div className='header card'><div><strong>{user.name}</strong><div className='small'>Professore</div></div><div><button className='btn' onClick={onLogout}>Logout</button></div></div><div className='grid'><div><ClassList selected={selectedClass} onSelect={setSelectedClass} /></div><div>{snapshot? <RegisterTable classeId={selectedClass} classeData={snapshot} backend={backend} socket={socket} /> : <div className='card'>Caricamento...</div>}</div><div><ActionsBar backend={backend} classId={selectedClass} /></div></div></div>);}